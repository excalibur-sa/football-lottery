# 云函数部署详细指南

##前置条件检查

在部署云函数前，请确认：

✅已在微信开发者工具中开通云开发环境
✅已成功导入 `bonus/miniprogram/` 项目目录
✅网络连接正常，能够访问微信云开发服务

## 详细部署步骤

###步1：定位云函数代码

1. 在文件资源管理器中找到项目根目录
2.进 `cloudfunctions/` 文件夹
3.确认包含以下三个子文件夹：
   - `getMatches/`
   - `getMatchOdds/`
   - `getOddsHistory/`

###步骤2：打开云开发面板

1. 在微信开发者工具中点击左侧边栏的"云开发"图标
2. 如果未开通云开发，点击"开通云开发"并按提示完成
3. 开通后选择"云函数"标签页

###步骤3：上传云函数

**方法一：拖拽上传（Windows系统推荐）**
1. 在文件资源管理器中选中 `cloudfunctions/` 文件夹
2. 拖拽到微信开发者工具云函数面板的空白区域
3. 系统会自动识别三个子文件夹

**方法二：手动创建（MAC系统推荐）**
1. 在云函数面板点击"+"号创建新函数
2. 分别创建名为 `getMatches`、`getMatchOdds`、`getOddsHistory` 的函数
3. 将本地对应文件夹中的代码文件复制到新创建的函数中

###步骤4：安装依赖并部署

对每个云函数执行以下操作：

1. **右键点击函数名称**
2. **选择"上传并部署：云端安装依赖"**
3. **等待部署完成**（通常需要1-3分钟）
4. **查看控制台输出**，确认显示"部署成功"

###步5：验证部署结果

1. 在云开发控制台的"云函数"页面查看函数列表
2.确认三个函数状态都显示为"已部署"
3.检查每个函数的"配置"选项卡，确认运行环境为Node.js

##常问题排查

### 问题1：上传失败，提示网络错误
**解决方案：**
-检查网络连接
- 重启微信开发者工具
-尝切换切换网络环境

### 问题2：依赖安装失败
**解决方案：**
-检查 `package.json` 文件格式是否正确
-确认云函数文件夹结构完整
-手动在云函数编辑器中运行 `npm install`

### 问题3：部署成功但调用失败
**解决方案：**
-云函数入口函数是否正确导出
-确认函数名称与小程序代码中调用的名称一致
- 查看云函数日志排查具体错误

### 问题4：找不到云函数
**解决方案：**
-确认已在小程序代码中正确初始化云开发
-检查 `project.config.json` 中的云开发配置
- 重新编译小程序项目

##验证测试

部署完成后，进行以下测试：

1. **首页数据加载测试**
   -编译运行小程序
   - 查看是否能正常显示比赛列表
   -检查控制台是否有错误信息

2. **详情页功能测试**
   -点击任意比赛的"查看赔率"
   -确认能正常跳转到详情页
   -验证赔率数据是否正确显示

3. **云函数调用测试**
   - 在云开发控制台的"监控"页面
   - 查看云函数调用次数和成功率
   - 确认没有持续的错误调用

## 注意事项

⚠️ **重要提醒：**
-首次部署可能需要较长时间，请耐心等待
-每个云函数的免费调用次数有限，注意监控使用量
-在开发阶段使用测试环境，避免影响生产数据
-定查看云函数日志，及时发现和解决问题

##技术支持

如遇无法解决的问题，可通过以下方式寻求帮助：
-微信开发者社区论坛
-微信开放平台技术支持
- 查看微信云开发官方文档